# E2E Test configuration for user info forwarding
service:
  name: "ChatbotGate E2E Test"
  description: "E2E test for user info forwarding"

server:
  auth_path_prefix: "/_auth"

# Proxy to test backend server
proxy:
  upstream:
    url: "http://localhost:8083"

# Session configuration
session:
  cookie:
    name: "_oauth2_proxy_e2e"
    secret: "e2e-test-cookie-secret-key-32-chars-long-12345678"
    expire: "1h"
    secure: false
    httponly: true
    samesite: "lax"

# OAuth2 providers (mock for testing)
oauth2:
  providers:
    - id: "stub-auth"
      type: "custom"
      display_name: "Test Provider"
      client_id: "test-client-id"
      client_secret: "test-client-secret"
      auth_url: "http://localhost:9999/oauth/authorize"
      token_url: "http://localhost:9999/oauth/token"
      userinfo_url: "http://localhost:9999/oauth/userinfo"
      insecure_skip_verify: true

# Email authentication (disabled for this test)
email_auth:
  enabled: false

# Authorization (allow all for testing)
access_control:
  emails: []

# Logging
logging:
  level: "debug"
  color: true

# KVS configuration (memory for testing)
kvs:
  default:
    type: "memory"
    memory:
      cleanup_interval: "1m"

# User information forwarding configuration (THE FEATURE WE'RE TESTING)
forwarding:
  # Encryption settings
  encryption:
    # IMPORTANT: This key must match the key used in the test backend server
    key: "e2e-test-encryption-key-32-chars-long-1234567890"
    algorithm: "aes-256-gcm"

  # Forward both username and email (encrypted) via query and headers
  fields:
    - path: "username"
      query: "username"
      header: "X-ChatbotGate-User"
      filters: encrypt
    - path: "email"
      query: "email"
      header: "X-ChatbotGate-Email"
      filters: encrypt
